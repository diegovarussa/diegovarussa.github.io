import{m as R,c as p,h as Q,A as me,aU as qe,bx as xe,a2 as U,j as Oe,by as Ee,ay as Qe,aJ as De,az as Ae,r as B,v as Ve,x as He,aK as Ne,aA as $e,aL as je,q as J,o as Z,at as X,ao as Y,S as Le,aa as Ie,k as fe,s as Re,al as Ue,bz as We,bA as Me,d as ze,C as W,D as _,E as x,F as i,a3 as D,a$ as Fe,H as r,a9 as q,w as Ke,$ as Ge,a4 as Je,bi as Ze,ah as $,a8 as A,W as Xe,b8 as Ye,bm as et,bn as tt,a5 as j,Z as w,bB as at,a7 as ot,a6 as nt}from"./index.27916069.js";import{Q as lt}from"./QPage.93e7fa2a.js";import{Q as ee}from"./QImg.cb06a441.js";import{c as te,a as ae,b as L,Q as st}from"./selection.f7747c77.js";import{u as rt,v as oe,a as it,p as ne,b as ut,c as ct,r as le,s as dt,d as mt}from"./position-engine.4d4be609.js";import{a as I,Q as se}from"./QItemLabel.2efb22ae.js";import{u as ft}from"./use-quasar.0007e690.js";import{C as re}from"./index.2c306793.js";import{Q as vt,a as gt}from"./QToolbar.7e424616.js";import{u as ve,_ as ht,a as ie}from"./CommentList.1b86433e.js";var pt=R({name:"QBtnGroup",props:{unelevated:Boolean,outline:Boolean,flat:Boolean,rounded:Boolean,square:Boolean,push:Boolean,stretch:Boolean,glossy:Boolean,spread:Boolean},setup(e,{slots:t}){const o=p(()=>{const l=["unelevated","outline","flat","rounded","square","push","stretch","glossy"].filter(n=>e[n]===!0).map(n=>`q-btn-group--${n}`).join(" ");return`q-btn-group row no-wrap${l.length>0?" "+l:""}`+(e.spread===!0?" q-btn-group--spread":" inline")});return()=>Q("div",{class:o.value},me(t.default))}}),ue=R({name:"QBtnToggle",props:{...qe,modelValue:{required:!0},options:{type:Array,required:!0,validator:e=>e.every(t=>("label"in t||"icon"in t||"slot"in t)&&"value"in t)},color:String,textColor:String,toggleColor:{type:String,default:"primary"},toggleTextColor:String,outline:Boolean,flat:Boolean,unelevated:Boolean,rounded:Boolean,push:Boolean,glossy:Boolean,size:String,padding:String,noCaps:Boolean,noWrap:Boolean,dense:Boolean,readonly:Boolean,disable:Boolean,stack:Boolean,stretch:Boolean,spread:Boolean,clearable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","clear","click"],setup(e,{slots:t,emit:o}){const l=p(()=>e.options.find(s=>s.value===e.modelValue)!==void 0),n=p(()=>({type:"hidden",name:e.name,value:e.modelValue})),d=Ee(n),g=p(()=>xe(e)),u=p(()=>({rounded:e.rounded,dense:e.dense,...g.value})),C=p(()=>e.options.map((s,v)=>{const{attrs:P,value:y,slot:f,...a}=s;return{slot:f,props:{key:v,"aria-pressed":y===e.modelValue?"true":"false",...P,...a,...u.value,disable:e.disable===!0||a.disable===!0,color:y===e.modelValue?c(a,"toggleColor"):c(a,"color"),textColor:y===e.modelValue?c(a,"toggleTextColor"):c(a,"textColor"),noCaps:c(a,"noCaps")===!0,noWrap:c(a,"noWrap")===!0,size:c(a,"size"),padding:c(a,"padding"),ripple:c(a,"ripple"),stack:c(a,"stack")===!0,stretch:c(a,"stretch")===!0,onClick(h){T(y,s,h)}}}}));function T(s,v,P){e.readonly!==!0&&(e.modelValue===s?e.clearable===!0&&(o("update:modelValue",null,null),o("clear")):o("update:modelValue",s,v),o("click",P))}function c(s,v){return s[v]===void 0?e[v]:s[v]}function k(){const s=C.value.map(v=>Q(U,v.props,v.slot!==void 0?t[v.slot]:void 0));return e.name!==void 0&&e.disable!==!0&&l.value===!0&&d(s,"push"),Oe(t.default,s)}return()=>Q(pt,{class:"q-btn-toggle",...g.value,rounded:e.rounded,stretch:e.stretch,glossy:e.glossy,spread:e.spread},k)}}),ce=R({name:"QTooltip",inheritAttrs:!1,props:{...rt,...Qe,...De,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{default:"jump-down"},transitionHide:{default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:oe},self:{type:String,default:"top middle",validator:oe},offset:{type:Array,default:()=>[14,14],validator:it},scrollTarget:{default:void 0},delay:{type:Number,default:0},hideDelay:{type:Number,default:0}},emits:[...Ae],setup(e,{slots:t,emit:o,attrs:l}){let n,d;const g=fe(),{proxy:{$q:u}}=g,C=B(null),T=B(!1),c=p(()=>ne(e.anchor,u.lang.rtl)),k=p(()=>ne(e.self,u.lang.rtl)),s=p(()=>e.persistent!==!0),{registerTick:v,removeTick:P}=Ve(),{registerTimeout:y}=He(),{transitionProps:f,transitionStyle:a}=Ne(e),{localScrollTarget:h,changeScrollEvent:he,unconfigureScrollTarget:pe}=ut(e,K),{anchorEl:b,canShow:ye,anchorEvents:O}=ct({showing:T,configureAnchorEl:we}),{show:be,hide:H}=$e({showing:T,canShow:ye,handleShow:Ce,handleHide:ke,hideOnRouteChange:s,processOnMount:!0});Object.assign(O,{delayShow:Be,delayHide:Te});const{showPortal:M,hidePortal:z,renderPortal:_e}=je(g,C,Se,"tooltip");if(u.platform.is.mobile===!0){const m={anchorEl:b,innerRef:C,onClickOutside(S){return H(S),S.target.classList.contains("q-dialog__backdrop")&&Re(S),!0}},N=p(()=>e.modelValue===null&&e.persistent!==!0&&T.value===!0);J(N,S=>{(S===!0?mt:le)(m)}),Z(()=>{le(m)})}function Ce(m){M(),v(()=>{d=new MutationObserver(()=>E()),d.observe(C.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),E(),K()}),n===void 0&&(n=J(()=>u.screen.width+"|"+u.screen.height+"|"+e.self+"|"+e.anchor+"|"+u.lang.rtl,E)),y(()=>{M(!0),o("show",m)},e.transitionDuration)}function ke(m){P(),z(),F(),y(()=>{z(!0),o("hide",m)},e.transitionDuration)}function F(){d!==void 0&&(d.disconnect(),d=void 0),n!==void 0&&(n(),n=void 0),pe(),X(O,"tooltipTemp")}function E(){const m=C.value;b.value===null||!m||dt({el:m,offset:e.offset,anchorEl:b.value,anchorOrigin:c.value,selfOrigin:k.value,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function Be(m){if(u.platform.is.mobile===!0){te(),document.body.classList.add("non-selectable");const N=b.value,S=["touchmove","touchcancel","touchend","click"].map(G=>[N,G,"delayHide","passiveCapture"]);Y(O,"tooltipTemp",S)}y(()=>{be(m)},e.delay)}function Te(m){u.platform.is.mobile===!0&&(X(O,"tooltipTemp"),te(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),y(()=>{H(m)},e.hideDelay)}function we(){if(e.noParentEvent===!0||b.value===null)return;const m=u.platform.is.mobile===!0?[[b.value,"touchstart","delayShow","passive"]]:[[b.value,"mouseenter","delayShow","passive"],[b.value,"mouseleave","delayHide","passive"]];Y(O,"anchor",m)}function K(){if(b.value!==null||e.scrollTarget!==void 0){h.value=Le(b.value,e.scrollTarget);const m=e.noParentEvent===!0?E:H;he(h.value,m)}}function Pe(){return T.value===!0?Q("div",{...l,ref:C,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",l.class],style:[l.style,a.value],role:"tooltip"},me(t.default)):null}function Se(){return Q(Ie,f.value,Pe)}return Z(F),Object.assign(g.proxy,{updatePosition:E}),_e}});function de(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const t=parseInt(e,10);return isNaN(t)?0:t}var yt=Ue({name:"close-popup",beforeMount(e,{value:t}){const o={depth:de(t),handler(l){o.depth!==0&&setTimeout(()=>{const n=We(e);n!==void 0&&Me(n,l,o.depth)})},handlerKey(l){ze(l,13)===!0&&o.handler(l)}};e.__qclosepopup=o,e.addEventListener("click",o.handler),e.addEventListener("keyup",o.handlerKey)},updated(e,{value:t,oldValue:o}){t!==o&&(e.__qclosepopup.depth=de(t))},beforeUnmount(e){const t=e.__qclosepopup;e.removeEventListener("click",t.handler),e.removeEventListener("keyup",t.handlerKey),delete e.__qclosepopup}});const bt=()=>!0;function _t(e){const t={};return e.forEach(o=>{t[o]=bt}),t}function V(){const{emit:e,proxy:t}=fe(),o=B(null);function l(){o.value.show()}function n(){o.value.hide()}function d(u){e("ok",u),n()}function g(){e("hide")}return Object.assign(t,{show:l,hide:n}),{dialogRef:o,onDialogHide:g,onDialogOK:d,onDialogCancel:n}}const ge=["ok","hide"];V.emits=ge;V.emitsObject=_t(ge);const Ct=W({__name:"AchievementComments",props:{achievementId:{type:Number,required:!0}},emits:[...V.emits],setup(e){const t=e,{dialogRef:o,onDialogHide:l}=V(),d=ve().getKey(`user_achievement_comments_${t.achievementId}`);return(g,u)=>(_(),x(Fe,{ref_key:"dialogRef",ref:o,onHide:D(l)},{default:i(()=>[r(Je,null,{default:i(()=>[r(vt,{class:"bg-primary"},{default:i(()=>[r(gt,null,{default:i(()=>[q("Achievement Comments")]),_:1}),Ke(r(U,{flat:"",round:"",dense:"",icon:"close"},null,512),[[yt]])]),_:1}),r(Ge,null,{default:i(()=>[r(ht,{comments:D(d).data,class:"q-ma-sm q-pa-sm"},null,8,["comments"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}}),kt=W({__name:"AchievementItem",props:{achievement:null,comments:null},setup(e){const t=ft();function o(l){t.dialog({component:Ct,componentProps:{achievementId:l}})}return(l,n)=>(_(),x(st,{class:"col-12 col-lg-3 shadow-10 q-ma-lg q-pa-sm"},{default:i(()=>[r(ae,null,{default:i(()=>[r(L,{avatar:""},{default:i(()=>[r(Ze,{rounded:"",class:"shadow-1",size:"8em"},{default:i(()=>[e.achievement.dateEarnedHardcore?(_(),x(ee,{key:0,src:`${D(re).BADGE_MEDIA_URL}/${e.achievement.badgeName}.png`},null,8,["src"])):$("",!0),e.achievement.dateEarnedHardcore?$("",!0):(_(),x(ee,{key:1,src:`${D(re).BADGE_MEDIA_URL}/${e.achievement.badgeName}_lock.png`},null,8,["src"]))]),_:1})]),_:1}),r(L,{top:""},{default:i(()=>[r(I,null,{default:i(()=>[r(se,{square:"",dense:"",color:"secondary",size:"md"},{default:i(()=>[q(A(e.achievement.points)+" ",1),r(ce,{class:"bg-dark",anchor:"top middle",self:"center middle"},{default:i(()=>[q(" Points ")]),_:1})]),_:1}),r(se,{square:"",dense:"",color:"primary",size:"md"},{default:i(()=>[q(A(e.achievement.trueRatio)+" ",1),r(ce,{class:"bg-dark",anchor:"top middle",self:"center middle"},{default:i(()=>[q(" True Ratio (Difficult Points) ")]),_:1})]),_:1}),e.comments?(_(),x(U,{key:0,onClick:n[0]||(n[0]=d=>o(e.achievement.id)),class:"float-right",size:"sm",dense:"",outline:"",icon:"forum",color:"info",label:e.comments.length},null,8,["label"])):$("",!0)]),_:1}),r(I,{lines:"4"},{default:i(()=>[q(A(e.achievement.title),1)]),_:1})]),_:1})]),_:1}),r(ae,null,{default:i(()=>[r(L,null,{default:i(()=>[r(I,{caption:""},{default:i(()=>[q(A(e.achievement.description),1)]),_:1})]),_:1})]),_:1})]),_:1}))}}),Bt={key:0,class:"row justify-center"},Tt={class:"row text-center col-10"},wt=w("div",{class:"col-12 col-lg-1 q-mt-sm q-mr-"},"Filter: ",-1),Pt={class:"col-12 col-lg-3"},St={class:"col-12 col-lg-2"},qt=w("div",{class:"col-12 col-lg-1 q-mt-sm q-mr-sm"},"Order: ",-1),xt={class:"col-12 col-lg-4"},Ot={class:"row justify-center full-width"},Et={key:1,class:"text-center"},Qt=w("h4",null,"No achievements for this game yet.",-1),Dt=[Qt],Wt=W({__name:"RetroGamePage",async setup(e){let t,o;const l=B(new Map),n=B(!1),d=B(!1),g=tt(),u=ve(1e3*60*60*1),C=Xe([{label:"All",value:"all"},{label:"Locked",value:"locked"},{label:"Unlocked",value:"unlocked"}]),T=[{label:"Default",value:"default"},{label:"By Difficult",value:"difficult"},{label:"By Points",value:"points"}],c=B("all"),k=B("default"),s=B(([t,o]=Ye(()=>u.getGameUserProgress(Number(g.params.id))),t=await t,o(),t));et(async()=>{s.value=await u.getGameUserProgress(Number(g.params.id)),s.value.achievements.length&&u.getKey(`user_achievement_comments_${s.value.achievements[0].id}`)&&(l.value=(await ie(Number(g.params.id),s.value.achievements)).comments)});const v=p(()=>s.value?[...s.value.achievements].sort((f,a)=>k.value==="difficult"?a.trueRatio-f.trueRatio:k.value==="points"?a.points-f.points:k.value==="default"?f.displayOrder-a.displayOrder:0):[]),P=p(()=>{let f=v.value;return c.value==="unlocked"&&(f=f.filter(a=>{if(a.dateEarnedHardcore!==null)return a})),c.value==="locked"&&(f=f.filter(a=>{if(a.dateEarnedHardcore===null)return a})),d.value&&(f=f.filter(a=>{if(l.value.has(a.id.toString()))return a})),f});async function y(){d.value&&(n.value=!0,l.value=(await ie(Number(g.params.id),s.value.achievements)).comments,n.value=!1)}return(f,a)=>(_(),x(lt,{padding:""},{default:i(()=>[s.value.achievements.length?(_(),j("div",Bt,[w("div",Tt,[wt,w("div",Pt,[r(ue,{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=h=>c.value=h),"toggle-color":"primary",options:C},null,8,["modelValue","options"])]),w("div",St,[r(at,{modelValue:d.value,"onUpdate:modelValue":[a[1]||(a[1]=h=>d.value=h),y],disable:n.value,label:"Comments"},null,8,["modelValue","disable"])]),qt,w("div",xt,[r(ue,{modelValue:k.value,"onUpdate:modelValue":a[2]||(a[2]=h=>k.value=h),"toggle-color":"primary",options:T},null,8,["modelValue"])])]),w("div",Ot,[(_(!0),j(ot,null,nt(D(P),h=>(_(),x(kt,{key:h.id,comments:l.value.get(h.id.toString()),achievement:h},null,8,["comments","achievement"]))),128))])])):(_(),j("div",Et,Dt))]),_:1}))}});export{Wt as default};
