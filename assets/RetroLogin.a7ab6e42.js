import{m as F,r as P,y as B,z as I,a as k,h as E,A as K,k as L,bc as M,s as S,M as j,bd as D,B as O,be as U,C as $,D as z,E as H,F as r,aS as N,H as n,a4 as T,$ as q,bf as Q,g as V,a1 as W,a2 as Z,Z as R,aO as G}from"./index.275fbde5.js";import{Q as J}from"./QPage.dcae9484.js";import{a as X,b as Y}from"./QLayout.19c6845f.js";import{C as ee}from"./index.4348e416.js";import{u as te}from"./use-quasar.34503c93.js";import{u as ae}from"./use-meta.67fb55b2.js";var oe=F({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(c,{slots:m,emit:p}){const u=L(),i=P(null);let d=0;const a=[];function o(e){const f=typeof e=="boolean"?e:c.noErrorFocus!==!0,g=++d,C=(t,s)=>{p("validation"+(t===!0?"Success":"Error"),s)},_=t=>{const s=t.validate();return typeof s.then=="function"?s.then(l=>({valid:l,comp:t}),l=>({valid:!1,comp:t,err:l})):Promise.resolve({valid:s,comp:t})};return(c.greedy===!0?Promise.all(a.map(_)).then(t=>t.filter(s=>s.valid!==!0)):a.reduce((t,s)=>t.then(()=>_(s).then(l=>{if(l.valid===!1)return Promise.reject(l)})),Promise.resolve()).catch(t=>[t])).then(t=>{if(t===void 0||t.length===0)return g===d&&C(!0),!0;if(g===d){const{comp:s,err:l}=t[0];if(l!==void 0&&console.error(l),C(!1,s),f===!0){const A=t.find(({comp:w})=>typeof w.focus=="function"&&M(w.$)===!1);A!==void 0&&A.comp.focus()}}return!1})}function v(){d++,a.forEach(e=>{typeof e.resetValidation=="function"&&e.resetValidation()})}function b(e){e!==void 0&&S(e);const f=d+1;o().then(g=>{f===d&&g===!0&&(c.onSubmit!==void 0?p("submit",e):e!==void 0&&e.target!==void 0&&typeof e.target.submit=="function"&&e.target.submit())})}function h(e){e!==void 0&&S(e),p("reset"),j(()=>{v(),c.autofocus===!0&&c.noResetFocus!==!0&&y()})}function y(){D(()=>{if(i.value===null)return;const e=i.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||i.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||i.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(i.value.querySelectorAll("[tabindex]"),f=>f.tabIndex>-1);e!=null&&e.focus({preventScroll:!0})})}O(U,{bindComponent(e){a.push(e)},unbindComponent(e){const f=a.indexOf(e);f>-1&&a.splice(f,1)}});let x=!1;return B(()=>{x=!0}),I(()=>{x===!0&&c.autofocus===!0&&y()}),k(()=>{c.autofocus===!0&&y()}),Object.assign(u.proxy,{validate:o,resetValidation:v,submit:b,reset:h,focus:y,getValidationComponents:()=>a}),()=>E("form",{class:"q-form",ref:i,onSubmit:b,onReset:h},K(m.default))}});const ne=R("p",{class:"text-grey-6"}," To get your Web API key, visit your control panel on the RetroAchievements website. ",-1),se=R("a",{href:"https://retroachievements.org/controlpanel.php",target:"_blank",class:"text-secondary"}," https://retroachievements.org ",-1),me=$({__name:"RetroLogin",setup(c){ae({title:"Login - RA Manager"});const m=te(),p=N(),u=P({username:"",webApiKey:""}),i=a=>!!a||"Required";async function d(){const a=new ee(u.value.username,u.value.webApiKey);try{m.loading.show();const o=await a.isCredentialsValid();o.valid?(G.set("retroAchievementsCredentials",u.value),p.push("retro")):m.notify({type:"negative",message:o.message,progress:!0})}catch(o){m.notify({type:"negative",message:"Invalid Credentials",caption:String(o),progress:!0})}finally{m.loading.hide()}}return(a,o)=>(z(),H(X,{view:"hHh lpR fFf"},{default:r(()=>[n(Y,null,{default:r(()=>[n(J,{class:"fit row justify-center items-center"},{default:r(()=>[n(oe,{onSubmit:d},{default:r(()=>[n(T,{square:"",class:"shadow-24 q-mx-sm col-lg-3"},{default:r(()=>[n(q,null,{default:r(()=>[n(Q,{"data-cy":"username",square:"",modelValue:u.value.username,"onUpdate:modelValue":o[0]||(o[0]=v=>u.value.username=v),label:"Username",rules:[i]},{prepend:r(()=>[n(V,{name:"person"})]),_:1},8,["modelValue","rules"]),n(Q,{"data-cy":"key",square:"",modelValue:u.value.webApiKey,"onUpdate:modelValue":o[1]||(o[1]=v=>u.value.webApiKey=v),label:"Web API Key",rules:[i]},{prepend:r(()=>[n(V,{name:"webhook"})]),_:1},8,["modelValue","rules"])]),_:1}),n(W,{class:"q-px-lg"},{default:r(()=>[n(Z,{"data-cy":"login",unelevated:"",size:"lg",color:"secondary",type:"submit",class:"full-width text-white",label:"Login"})]),_:1}),n(q,{class:"text-center"},{default:r(()=>[ne,se]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}});export{me as default};
